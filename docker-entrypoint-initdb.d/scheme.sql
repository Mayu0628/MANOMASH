CREATE TABLE IF NOT EXISTS users (
  user_id       INTEGER UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  user_name     VARCHAR(40)     NOT NULL,
  email         VARCHAR(254)     NOT NULL,
  password      VARCHAR(20)     NOT NULL,
  introduce		VARCHAR(100)	NOT NULL,
  created_at    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at    DATETIME
);

CREATE TABLE IF NOT EXISTS oshis (
  oshi_id		INTEGER UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  user_id   INTEGER UNSIGNED,
  oshi_name		VARCHAR(100)	NOT NULL,
  birthday		DATETIME 			NOT NULL,
  oshi_meet		VARCHAR(1024)	NOT NULL,
  free_space	VARCHAR(1024)	NOT NULL,
  interest		VARCHAR(1024)	NOT NULL,
  reaction_num	INTEGER UNSIGNED,
  created_at	DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at	DATETIME,
  deleted_at    DATETIME,
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS tag (
  tag_id     INTEGER UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  tag_name   VARCHAR(100)
);

CREATE TABLE IF NOT EXISTS oshi_tag (
  oshi_id		INTEGER UNSIGNED,
  tag_id		INTEGER UNSIGNED,
  PRIMARY KEY (oshi_id,tag_id),
  FOREIGN KEY (oshi_id) REFERENCES oshis(oshi_id) ON DELETE CASCADE,
  FOREIGN KEY (tag_id) REFERENCES tag(tag_id) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS oshi_like (
  oshi_id		INTEGER UNSIGNED,
  like_point	VARCHAR(254) NOT NULL,
  FOREIGN KEY (oshi_id) REFERENCES oshis(oshi_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS comments (
  oshi_id    	INTEGER UNSIGNED NOT NULL,
  nice_num		INTEGER UNSIGNED NOT NULL,
  comment       VARCHAR(255) NOT NULL,
  user_id       INTEGER UNSIGNED NOT NULL,
  created_at    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at    DATETIME,
  deleted_at    DATETIME,
  FOREIGN KEY (oshi_id) REFERENCES oshis(oshi_id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
